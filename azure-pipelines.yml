trigger:
- bla

pool:
    vmImage: 'windows-latest'

steps:


- task: DownloadSecureFile@1
  inputs:
    secureFile: 'ARandomNumber.ipa'
  name: app

- task: Build-2Secure@0
  inputs:
    Platform: 'ios'
    Sign: 'signOnAppdome'
    App: '$(app.secureFilePath)'
    Token: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoiNzk5MTY5NDAtMWJmZS0xMWVlLWI4NzItOWJkZTg0M2QyYmUyIiwic2FsdCI6IjkyOTI0NjRhLWY4MTUtNDA5Zi05NGJiLTE5MTFjMWZiNTFmMCJ9.D1ywWh1K6pabwdFEJTMyd6BA1nBlIDKMvGEGQG976io'
    FusionSetId: '7eeb3600-295f-11ee-8107-df185da8f11b'
    CertificateFile: 'https://appdome-automation-vanilla-apps.s3.amazonaws.com/Thomas/PipelineFiles/AutomationCert.p12?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAUMYEOMD5CS6O3AWM%2F20241016%2Feu-central-1%2Fs3%2Faws4_request&X-Amz-Date=20241016T124743Z&X-Amz-Expires=36000&X-Amz-SignedHeaders=host&X-Amz-Signature=da443a14193e6987dbf2c21f929ec0f229f31db062802c5ea0ecf58ac59ad93e'
    CertificatePass: 'bla1;bla2'
    Entitlements: 'https://appdome-automation-vanilla-apps.s3.amazonaws.com/Thomas/PipelineFiles/AutomationEntitlements.plist?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAUMYEOMD5CS6O3AWM%2F20241016%2Feu-central-1%2Fs3%2Faws4_request&X-Amz-Date=20241016T124743Z&X-Amz-Expires=36000&X-Amz-SignedHeaders=host&X-Amz-Signature=d5ab85ce7bf418c149f8967a95898f6dbfa6df9a9277f0fbe99a8865ca9de5a2'
    ProvisioningProfile: 'https://appdome-automation-vanilla-apps.s3.amazonaws.com/Thomas/PipelineFiles/Automation.mobileprovision?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAUMYEOMD5CS6O3AWM%2F20241016%2Feu-central-1%2Fs3%2Faws4_request&X-Amz-Date=20241016T124743Z&X-Amz-Expires=36000&X-Amz-SignedHeaders=host&X-Amz-Signature=67ee76b6ad076a6a3f12c592872538bad1e2d1dd41162c1ea33b198b4ac49bdf'
  name: 'buildTask'

- script: |
   echo "Built APK file: $(buildTask.AppDomeSecuredApp)"\
   echo "dir: $(buildTask.AppdomeOutputsDir)"


- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(buildTask.AppDomeSecuredApp)'
    ArtifactName: 'Appdome Output'   

- task: PublishBuildArtifacts@1
  inputs:
    PathtoPublish: '$(buildTask.AppdomeOutputsDir)'
    ArtifactName: 'Appdome Output1'   
